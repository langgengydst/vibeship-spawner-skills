# SOX Compliance

> Use when implementing Sarbanes-Oxley compliance, internal controls, audit trails, segregation of duties, or continuous monitoring - covers COSO framework and IT general controls

**Category:** legal | **Version:** 1.0.0

---

## Patterns


## Anti-Patterns


## Sharp Edges (Gotchas)

*Real production issues that cause outages and bugs.*

### [CRITICAL] Multiple users sharing the same service account breaks accountability

**Why it happens:**
SOX requires individual accountability for actions affecting financial
data. When multiple people share credentials, you cannot determine
who performed a specific action. This is a common material weakness.


**Solution:**
```
1. Individual user accounts for all access:
   - Each user has unique credentials
   - Tie actions to individuals in audit logs

2. Service accounts for automation only:
   - Not shared with humans
   - Rotate credentials regularly
   - Monitor usage for anomalies

3. Privileged Access Management:
   - Check out credentials when needed
   - Full session recording
   - Automatic rotation after use

```

**Symptoms:**
- Application uses single service account for all access
- Multiple people know the password
- Cannot trace actions to individuals

---

### [CRITICAL] Segregation of duties failure - same person can write and deploy code

**Why it happens:**
SOX requires segregation of duties to prevent fraud. If developers
can both write code and push to production, they could manipulate
financial calculations without detection. This is a common ITGC
material weakness.


**Solution:**
```
1. Separate environments with different access:
   - Dev: Developers have access
   - Test: QA has access
   - Prod: Operations only (not developers)

2. Automated deployment pipelines:
   - Code flows through pipeline
   - Approvals required at each stage
   - Developers cannot push directly

3. Emergency change procedures:
   - Documented exception process
   - Post-change review required
   - Temporary access with monitoring

```

**Symptoms:**
- Developers can access production directly
- Same person develops and deploys
- No change approval process

---

### [HIGH] No log of who changed what, when, and why

**Why it happens:**
SOX Section 802 requires record retention. Auditors need to trace
any financial data back to its source. Without audit trails, you
cannot prove controls operated effectively.


**Solution:**
```
1. Application-level audit logging:
   - Log all data changes (CREATE, UPDATE, DELETE)
   - Include: user, timestamp, old value, new value
   - Store in immutable audit table

2. Database-level protection:
   - Revoke direct UPDATE/DELETE from users
   - All changes through application with logging
   - Trigger-based audit trail as backup

3. Log integrity:
   - Write-once audit logs (immutable)
   - Separate log storage from app database
   - Regular log verification

```

**Symptoms:**
- Direct database updates allowed
- No change logging
- Cannot reconstruct history

---

### [HIGH] Stale access accumulates as people change roles

**Why it happens:**
Access rights accumulate over time. Without regular reviews,
people retain access they no longer need. This creates fraud
risk and segregation of duties failures.


**Solution:**
```
1. Quarterly access reviews:
   - Manager certifies each user's access
   - Compare current access to job requirements
   - Remove stale access

2. Role-based access with lifecycle:
   - Access tied to job role
   - Role change triggers access review
   - Termination removes all access immediately

3. Privileged access review:
   - Monthly review of admin access
   - Justify each privileged account
   - Time-limited elevated access

```

**Symptoms:**
- Former employees still have access
- Role changes don't trigger access review
- No documentation of access decisions

---

## Collaboration

### When to Hand Off

| Trigger | Delegate To | Context |
|---------|-------------|--------|
| `gdpr|privacy|personal.data` | gdpr-privacy | Privacy-specific controls |
| `contract|vendor|agreement` | contract-analysis | Vendor compliance provisions |
| `export|international` | export-control | Export compliance |

### Receives Work From

- **gdpr-privacy**: Privacy controls
- **contract-analysis**: Vendor audit provisions

---

## Get the Full Version

This skill has **automated validations**, **detection patterns**, and **structured handoff triggers** that work with the Spawner orchestrator.

```bash
npx vibeship-spawner-skills install
```

Full skill path: `~/.spawner/skills/legal/sox-compliance/`

**Includes:**
- `skill.yaml` - Structured skill definition
- `sharp-edges.yaml` - Machine-parseable gotchas with detection patterns
- `validations.yaml` - Automated code checks
- `collaboration.yaml` - Handoff triggers for skill orchestration

---

*Generated by [VibeShip Spawner](https://github.com/vibeforge1111/vibeship-spawner-skills)*
