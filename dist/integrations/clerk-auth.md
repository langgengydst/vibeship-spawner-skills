# Clerk Authentication

> Expert patterns for Clerk auth implementation, middleware, organizations, webhooks, and user sync

**Category:** integrations | **Version:** 1.0.0

**Tags:** clerk, authentication, auth, user-management, multi-tenancy, organizations, sso, oauth

---

## Patterns

### Next.js App Router Setup
Complete Clerk setup for Next.js 14/15 App Router.

Includes ClerkProvider, environment variables, and basic
sign-in/sign-up components.

Key components:
- ClerkProvider: Wraps app for auth context
- <SignIn />, <SignUp />: Pre-built auth forms
- <UserButton />: User menu with session management


### Middleware Route Protection
Protect routes using clerkMiddleware and createRouteMatcher.

Best practices:
- Single middleware.ts file at project root
- Use createRouteMatcher for route groups
- auth.protect() for explicit protection
- Centralize all auth logic in middleware


### Server Component Authentication
Access auth state in Server Components using auth() and currentUser().

Key functions:
- auth(): Returns userId, sessionId, orgId, claims
- currentUser(): Returns full User object
- Both require clerkMiddleware to be configured


### Client Component Hooks
Access auth state in Client Components using hooks.

Key hooks:
- useUser(): User object and loading state
- useAuth(): Auth state, signOut, etc.
- useSession(): Session object
- useOrganization(): Current organization


### Organizations and Multi-Tenancy
Implement B2B multi-tenancy with Clerk Organizations.

Features:
- Multiple orgs per user
- Roles and permissions
- Organization-scoped data
- Enterprise SSO per organization


### Webhook User Sync
Sync Clerk users to your database using webhooks.

Key webhooks:
- user.created: New user signed up
- user.updated: User profile changed
- user.deleted: User deleted account

Uses svix for signature verification.


### API Route Protection
Protect API routes using auth() from Clerk.

Route Handlers in App Router use auth() for authentication.
Middleware provides initial protection, auth() provides in-handler verification.



## Sharp Edges (Gotchas)

*Real production issues that cause outages and bugs.*

### [CRITICAL] undefined

---

### [HIGH] undefined

---

### [HIGH] undefined

---

### [HIGH] undefined

---

### [MEDIUM] undefined

---

### [MEDIUM] undefined

---

### [MEDIUM] undefined

---

### [MEDIUM] undefined

---

### [MEDIUM] undefined

---

### [HIGH] undefined

---

## Collaboration

### When to Hand Off

| Trigger | Delegate To | Context |
|---------|-------------|--------|
| `user needs database` | postgres-wizard | User table with clerkId |
| `user needs payments` | stripe-integration | Customer linked to Clerk user |
| `user needs search` | algolia-search | Secured API keys per user |
| `user needs analytics` | segment-cdp | User identification |
| `user needs email` | resend-email | Transactional emails |

---

## Get the Full Version

This skill has **automated validations**, **detection patterns**, and **structured handoff triggers** that work with the Spawner orchestrator.

```bash
npx vibeship-spawner-skills install
```

Full skill path: `~/.spawner/skills/integrations/clerk-auth/`

**Includes:**
- `skill.yaml` - Structured skill definition
- `sharp-edges.yaml` - Machine-parseable gotchas with detection patterns
- `validations.yaml` - Automated code checks
- `collaboration.yaml` - Handoff triggers for skill orchestration

---

*Generated by [VibeShip Spawner](https://github.com/vibeforge1111/vibeship-spawner-skills)*
