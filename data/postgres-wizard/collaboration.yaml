# PostgreSQL Wizard Collaboration Model
# How this skill works with other AI memory specialists

prerequisites:
  skills: []
  knowledge:
    - "SQL fundamentals (SELECT, JOIN, WHERE)"
    - "Basic understanding of indexes"
    - "Transaction concepts (ACID)"
    - "Understanding of table relations"

complementary_skills:
  - skill: performance-hunter
    relationship: "Application-level profiling"
    brings: "End-to-end latency analysis, bottleneck identification"

  - skill: data-engineer
    relationship: "Data pipeline integration"
    brings: "ETL design, data quality, batch processing"

  - skill: migration-specialist
    relationship: "Schema migrations"
    brings: "Zero-downtime migrations, backward compatibility"

  - skill: infra-architect
    relationship: "Database deployment"
    brings: "Kubernetes operators, HA setup, backup strategies"

  - skill: observability-sre
    relationship: "Database monitoring"
    brings: "pg_stat dashboards, alerting, SLO tracking"

  - skill: vector-specialist
    relationship: "pgvector optimization"
    brings: "Embedding strategies, similarity search patterns"

delegation:
  - trigger: "application slow despite fast queries"
    delegate_to: performance-hunter
    pattern: parallel
    context: "Query performance metrics and execution plans"
    receive: "Application-level bottleneck analysis"

  - trigger: "need data pipeline from PostgreSQL"
    delegate_to: data-engineer
    pattern: sequential
    context: "Table schemas and data volumes"
    receive: "CDC or batch pipeline design"

  - trigger: "need schema migration"
    delegate_to: migration-specialist
    pattern: sequential
    context: "Current schema and proposed changes"
    receive: "Zero-downtime migration plan"

  - trigger: "database deployment to Kubernetes"
    delegate_to: infra-architect
    pattern: parallel
    context: "PostgreSQL configuration and HA requirements"
    receive: "Kubernetes manifests and operator setup"

  - trigger: "need monitoring dashboards"
    delegate_to: observability-sre
    pattern: parallel
    context: "Key metrics (connections, slow queries, bloat)"
    receive: "Grafana dashboards and alerts"

  - trigger: "vector similarity optimization"
    delegate_to: vector-specialist
    pattern: parallel
    context: "Current pgvector setup and query patterns"
    receive: "Index tuning and query optimization"

collaboration_patterns:
  sequential:
    - "I optimize queries, then performance-hunter validates app latency"
    - "I design schema, then migration-specialist plans deployment"
    - "I tune vacuum, then observability-sre sets up monitoring"

  parallel:
    - "I optimize queries while infra-architect scales infrastructure"
    - "I index tables while vector-specialist tunes embeddings"

  review:
    - "Review migration-specialist's schema changes for performance impact"
    - "Review data-engineer's ETL queries for efficiency"
    - "Review infra-architect's PostgreSQL configuration"

cross_domain_insights:
  - domain: data-structures
    insight: "B-tree indexes are balanced trees - O(log n) lookup, O(n) for range"
    applies_when: "Choosing between btree, hash, GIN, GiST indexes"

  - domain: operating-systems
    insight: "shared_buffers is PostgreSQL's page cache, works with OS cache"
    applies_when: "Tuning memory parameters"

  - domain: distributed-systems
    insight: "Replication lag is eventual consistency - reads may be stale"
    applies_when: "Designing read replica strategy"

  - domain: statistics
    insight: "Query planner uses histogram statistics - sample quality matters"
    applies_when: "Debugging bad query plans"

  - domain: concurrency
    insight: "MVCC trades space for concurrency - vacuum reclaims space"
    applies_when: "Understanding bloat and vacuum"

ecosystem:
  primary_tools:
    - "psql - PostgreSQL CLI"
    - "pg_stat_statements - Query statistics extension"
    - "EXPLAIN ANALYZE - Query plan analysis"
    - "pgBadger - Log analyzer"
    - "pg_repack - Online table rebuild"

  alternatives:
    - name: pgAdmin
      use_when: "Need visual query builder and admin UI"
      avoid_when: "Performance-critical analysis (use psql)"

    - name: pgHero
      use_when: "Quick health check dashboard"
      avoid_when: "Deep optimization (use pg_stat_statements)"

    - name: TimescaleDB
      use_when: "Time-series data at scale"
      avoid_when: "General OLTP workload"

    - name: Citus
      use_when: "Need horizontal sharding"
      avoid_when: "Single-node performance is sufficient"

    - name: pg_hint_plan
      use_when: "Need to force specific query plans"
      avoid_when: "Can fix underlying statistics instead"

  deprecated:
    - "Guessing indexes without EXPLAIN"
    - "Ignoring vacuum and autovacuum"
    - "Running without connection pooler"
    - "Using ORM without understanding generated SQL"
    - "Tuning parameters without baseline metrics"

# Mind v5 Specific Context
mind_v5_specific:
  primary_responsibility: Event store and memory persistence with pgvectorscale
  pod: platform
  critical_artifacts:
    - src/infrastructure/postgres/*.py
    - deploy/k8s/postgres/*.yaml
    - src/core/events/store.py
  databases:
    primary:
      name: mind_events
      purpose: Event store with append-only semantics
      extensions:
        - pgvectorscale
        - pg_partman
    replica:
      name: mind_memories
      purpose: Memory projections for read queries
  key_tables:
    events:
      - event_id (UUID, PK)
      - aggregate_id (UUID, indexed)
      - event_type (varchar, indexed)
      - payload (jsonb)
      - occurred_at (timestamptz, partitioned)
      - correlation_id (UUID, indexed)
      - causation_id (UUID, indexed)
    memories:
      - memory_id (UUID, PK)
      - user_id (UUID, indexed, RLS)
      - content_encrypted (bytea)
      - embedding (vector(1536))
      - temporal_level (int)
      - salience (float)
      - valid_from (timestamptz)
      - valid_until (timestamptz, nullable)
  metrics_owned:
    - mind_pg_connections_active
    - mind_pg_query_duration_seconds
    - mind_pg_replication_lag_seconds
    - mind_pg_partition_count
  performance_targets:
    event_append: "<10ms p99"
    memory_query: "<50ms p99"
    connection_pool: "pgbouncer, 100 connections"
  delegation:
    - trigger: "vector search optimization"
      delegate_to: vector-specialist
      pattern: parallel
      context: "pgvectorscale indexes and query patterns"
      receive: "HNSW index configuration and query optimization"

    - trigger: "schema migration needed"
      delegate_to: migration-specialist
      pattern: sequential
      context: "Current schema and proposed changes"
      receive: "Zero-downtime migration plan with backward compat"

    - trigger: "database monitoring setup"
      delegate_to: observability-sre
      pattern: parallel
      context: "Key metrics and SLO requirements"
      receive: "pg_exporter config and Grafana dashboards"

    - trigger: "infrastructure scaling"
      delegate_to: infra-architect
      pattern: parallel
      context: "Resource requirements and HA needs"
      receive: "Kubernetes operator config and scaling policies"
